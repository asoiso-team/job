!function(a){var b,c,d,e,g;a.gesture||(b={preventDefault:!0},c={extend:function(a,b){var d,e,c={};for(d in a)c[d]=a[d];for(e in b)c[e]=b[e];return c},addCache:function(a,b,c){return a[b]?a[b].push(c):a[b]=[].concat(c),a},cutCache:function(a,b,c){return a[b]&&(a[b]=a[b].filter(function(a){return a!=c})),a},getDistance:function(a,b){return{x:b.centerX-a.centerX,y:b.centerY-a.centerY}},getAngle:function(a,b){var d=c.getDistance(a,b);return 180*Math.atan2(d.y,d.x)/Math.PI},getSpeed:function(a,b){var d,e,f,g=c.getDistance(a,b);return d=g.x,e=g.y,f=b.timeStamp-a.timeStamp,{x:Math.abs(d/f)||0,y:Math.abs(e/f)||0}},getDirect:function(a,b){var d={},g=c.getDistance(a,b),e=g.x,f=g.y;return d.right=e>0,d.up=0>f,d},getCenter:function(a){var b=[],d=[],e=[],f=[],g=Math.min,h=Math.max;return 1===a.length?{pageX:a[0].pageX,pageY:a[0].pageY,clientX:a[0].clientX,clientY:a[0].clientY}:(c.each(a,function(a){b.push(a.pageX),d.push(a.pageY),e.push(a.clientX),f.push(a.clientY)}),{pageX:(g.apply(Math,b)+h.apply(Math,b))/2,pageY:(g.apply(Math,d)+h.apply(Math,d))/2,clientX:(g.apply(Math,e)+h.apply(Math,e))/2,clientY:(g.apply(Math,f)+h.apply(Math,f))/2})},each:function(a,b,c){var d,e;if("forEach"in a)a.forEach(b,c);else if(void 0!==a.length){for(d=0,e=a.length;e>d;d++)if(b.call(c,a[d],d,a)===!1)return}else for(d in a)if(a.hasOwnProperty(d)&&b.call(c,a[d],d,a)===!1)return},getDirectByAngle:function(a){var b=Math.abs(a);return 45>b?"right":b>135?"left":a>0?"down":"up"}},d={prevent:function(a,b){b.preventDefault&&a.preventDefault()},filter:function(a){var b=c.getCenter(a.touches);return{centerX:b.clientX,centerY:b.clientY,target:a.target||a.srcElement,type:a.type,touches:a.touches,timeStamp:a.timeStamp}},getEventData:function(a){var d,b=["action","angle","speed","preventDefault","distance","durTime","orginEvent"],c={};for(d in a)b.indexOf(d)>-1&&(c[d]=a[d]);return c},runGesture:function(a,b,e){var h,i,f,j;d.prevent(a,e),f=this,h=this.posInfo.start,i=this.posInfo.current,"touchend"!=a.type?i=this.posInfo.current=d.filter(a):(this.posInfo.current=d.filter(a),this.posInfo.current.centerX=i.centerX,this.posInfo.current.centerY=i.centerY,i=this.posInfo.current);for(j in g.gestureActions)g.gestureActions[j].forEach(function(g){var l={action:b,instance:f,option:e,angle:c.getAngle(h,i),speed:c.getSpeed(h,i),distance:c.getDistance(h,i),durTime:i.timeStamp-h.timeStamp,direction:c.getDirect(h,i),preventDefault:a.preventDefault,runEvents:d.runEvents,orginEvent:a};g(l)})},runEvents:function(a,b){var c=b.instance.eventCache[a];c&&c.forEach(function(c){var g=d.getEventData(b);g.type=a,c(g)})}},e={touchstart:function(a,b){this.posInfo.start=d.filter(a),d.runGesture.call(this,a,"start",b)},touchmove:function(a,b){d.runGesture.call(this,a,"move",b)},touchend:function(a,b){d.runGesture.call(this,a,"end",b)}},a.gesture=function(a,b){return a=a||document,new g(a,b)},g=a.Gesture=function(a,d){var f,g;a=a||document,d=c.extend(b,d),this.eventCache={},this.posInfo={},f=this;for(g in e)!function(b){a.addEventListener(b,function(a){e[b].call(f,a,d)},!1)}(g)},g.gestureActions={},g.addPlugin=function(a){var b=function(b){var d=c.extend(a,b);d.option=c.extend(a.option,b.option),a.handler(d)};return c.addCache(g.gestureActions,a.name.toLowerCase(),b),g},g.prototype={constructor:g,on:function(a,b){var d,e;return b=b||function(){},d=a.split(" "),e=this,d.forEach(function(a){c.addCache(e.eventCache,a,b)}),this},off:function(a,b){var d,e;return b=b||function(){},d=a.split(" "),e=this,d.forEach(function(a){c.cutCache(e.eventCache,a,b)}),this}},g.addPlugin({name:"touch",direction:!0,option:{},handler:function(a){var d,b=a.name+a.action;a.runEvents(b,a),"move"==a.action&&(d=a.angle,dir=c.getDirectByAngle(d),b=a.name+dir,a.runEvents(b,a))}}),g.addPlugin({name:"swipe",direction:!0,option:{swipeSpeed:.5},handler:function(a){var b,d,e;"end"==a.action&&(b="",d=a.angle,(a.speed.x>=a.option.swipeSpeed||a.speed.y>=a.option.swipeSpeed)&&(b=c.getDirectByAngle(d)),e=a.name+b,a.runEvents(e,a))}}),g.addPlugin({name:"hold",option:{holdTime:1e3,offset:10},extra:{},handler:function(a){if("end"!=a.action){var b=a.name;a.distance.x>a.option.offset||a.distance.y>a.option.offset?(a.extra.timer&&clearTimeout(a.extra.timer),a.extra.timer=null):a.extra.timer||(a.extra.timer=setTimeout(function(){a.runEvents(b,a)},a.option.holdTime))}else a.extra.timer&&clearTimeout(a.extra.timer),a.extra.timer=null}}),g.addPlugin({name:"tap",option:{tapTime:500,offset:10},extra:{},handler:function(a){if("start"==a.action)a.extra.timer=setTimeout(function(){a.extra.timer=null},a.option.tapTime);else if("end"==a.action){var b=a.name;a.extra.timer&&a.distance.x<=a.option.offset&&a.distance.y<=a.option.offset&&a.runEvents(b,a),a.extra.timer&&clearTimeout(a.extra.timer),a.extra.timer=null}}}))}(window);